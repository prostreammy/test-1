<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Astro Ceria - Live</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/shaka-player@4.7.0/dist/controls.css">
    <script src="https://cdn.jsdelivr.net/npm/shaka-player@4.7.0/dist/shaka-player.ui.js"></script>
    <style>
        body { margin: 0; background: #000; display: flex; justify-content: center; align-items: center; height: 100vh; }
        .video-container { width: 100%; max-width: 900px; aspect-ratio: 16/9; }
        video { width: 100%; height: 100%; }
    </style>
</head>
<body>

<div class="video-container" id="video-parent">
    <video id="video" autoplay muted></video>
</div>

<script>
    async function initApp() {
        // Install built-in polyfills to patch browser incompatibilities
        shaka.polyfill.installAll();

        const video = document.getElementById('video');
        const player = new shaka.Player(video);

        // Configure DRM (Widevine)
        player.configure({
            drm: {
                servers: {
                    'com.widevine.alpha': 'https://widevine-proxy.astro.com.my/proxy' // Common Astro License Server
                }
            }
        });

        // Use your Vercel Proxy URL
        const manifestUri = '/api/ceria-proxy';

        try {
            await player.load(manifestUri);
            console.log('The video has now been loaded!');
        } catch (e) {
            console.error('Error code', e.code, 'object', e);
        }
    }

    document.addEventListener('DOMContentLoaded', initApp);
</script>
</body>
</html>
